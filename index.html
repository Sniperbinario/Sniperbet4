<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SniperBet - Estatísticas</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>SniperBet - Estatísticas dos Jogos</h1>
  <div id="jogos">Carregando jogos...</div>

  <script>
    async function carregarJogos() {
      try {
        const res = await fetch("/ultimos-jogos");
        const data = await res.json();
        const container = document.getElementById("jogos");

        if (!data.jogos || data.jogos.length === 0) {
          container.innerHTML = "<p>Nenhum jogo encontrado hoje.</p>";
          return;
        }

        container.innerHTML = "";
        data.jogos.forEach(jogo => {
          const div = document.createElement("div");
          div.className = "jogo";

          div.innerHTML = `
            <h2>${jogo.timeCasa} vs ${jogo.timeFora}</h2>
            <p><strong>Horário:</strong> ${jogo.horario}</p>
            <p><strong>Posição:</strong> ${jogo.posicaoCasa}º - ${jogo.posicaoFora}º</p>
            <ul>
              <li><strong>Média de Gols Feitos:</strong> ${jogo.estatisticasHome.mediaGolsFeitos} | ${jogo.estatisticasAway.mediaGolsFeitos}</li>
              <li><strong>Média de Gols Sofridos:</strong> ${jogo.estatisticasHome.mediaGolsSofridos} | ${jogo.estatisticasAway.mediaGolsSofridos}</li>
              <li><strong>Média de Escanteios:</strong> ${jogo.estatisticasHome.mediaEscanteios} | ${jogo.estatisticasAway.mediaEscanteios}</li>
              <li><strong>Média de Cartões:</strong> ${jogo.estatisticasHome.mediaCartoes} | ${jogo.estatisticasAway.mediaCartoes}</li>
              <li><strong>Média de Chutes Totais:</strong> ${jogo.estatisticasHome.mediaChutesTotais} | ${jogo.estatisticasAway.mediaChutesTotais}</li>
              <li><strong>Média de Chutes no Gol:</strong> ${jogo.estatisticasHome.mediaChutesGol} | ${jogo.estatisticasAway.mediaChutesGol}</li>
            </ul>
            <button onclick="verAoVivo('${jogo.timeCasa} vs ${jogo.timeFora}', this)">Ver Análise ao Vivo</button>
            <div class="ao-vivo"></div>
          `;
          container.appendChild(div);
        });
      } catch (err) {
        document.getElementById("jogos").innerText = "Erro ao carregar jogos.";
        console.error(err);
      }
    }

    async function verAoVivo(jogo, botao) {
      botao.disabled = true;
      const div = botao.nextElementSibling;
      div.innerText = "Buscando...";
      try {
        const res = await fetch(`/analise-ao-vivo?jogo=${encodeURIComponent(jogo)}`);
        const dados = await res.json();
        div.innerText = dados.textoBruto || "Dados não encontrados.";
        div.style.display = "block";
      } catch (e) {
        div.innerText = "Erro na análise ao vivo.";
      }
      botao.disabled = false;
    }

    carregarJogos();
  </script>
</body>
</html>
